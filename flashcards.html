<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¼æ¥­æ³• è„³ç§‘å­¦ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #f3f4f6; color: #1f2937; -webkit-tap-highlight-color: transparent; }
        
        .nav-link { opacity: 0.7; transition: all 0.2s; padding: 0.5rem 0.8rem; border-radius: 0.5rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; }
        .nav-link.active { opacity: 1; background-color: rgba(255,255,255,0.2); font-weight: bold; border: 1px solid rgba(255,255,255,0.3); }
        @media (max-width: 768px) { .nav-text { display: none; } }

        /* Card Container */
        .card-container { perspective: 1000px; height: 420px; width: 100%; max-width: 450px; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        .flipped .card-inner { transform: rotateY(180deg); }
        
        .card-front, .card-back { 
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden; 
            border-radius: 1.5rem; background-color: white; display: flex; flex-direction: column; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; padding: 2rem;
        }
        .card-back { transform: rotateY(180deg); overflow-y: auto; text-align: left; }

        /* Content Styling */
        .highlight { background: linear-gradient(transparent 60%, #fef08a 60%); font-weight: 700; padding: 0 2px; }
        strong { color: #1e40af; font-weight: 700; }
        
        /* Animation */
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Custom Scrollbar */
        .card-back::-webkit-scrollbar { width: 4px; }
        .card-back::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body class="h-screen flex flex-col items-center overflow-hidden">

    <header class="bg-slate-800 text-white shadow-md w-full flex-shrink-0 z-10">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-lg font-bold flex items-center gap-2"><i class="fas fa-brain text-pink-400"></i> Brain Cards</h1>
            <nav class="flex gap-1 sm:gap-2 text-sm">
                <a href="index.html" class="nav-link"><i class="fas fa-list-ul"></i> <span class="nav-text">ç›®æ¬¡</span></a>
                <a href="Visual_Flow_App.html" class="nav-link"><i class="fas fa-project-diagram"></i> <span class="nav-text">å›³è§£</span></a>
                <a href="flashcards.html" class="nav-link active"><i class="fas fa-layer-group"></i> <span class="nav-text">æš—è¨˜</span></a>
            </nav>
        </div>
    </header>

    <main class="w-full flex-1 flex flex-col items-center justify-center p-4">
        <!-- Progress Info -->
        <div class="w-full max-w-md mb-4 flex justify-between items-end px-2">
            <div class="text-left">
                <div id="topicDisplay" class="text-[10px] text-blue-600 font-bold uppercase tracking-widest truncate max-w-[200px]">---</div>
                <div id="rankDisplay" class="mt-1"></div>
            </div>
            <div id="progressDisplay" class="text-xs font-bold text-gray-400">0 / 0</div>
        </div>

        <!-- Flashcard -->
        <div class="card-container cursor-pointer" id="cardElement" onclick="toggleFlip()">
            <div class="card-inner" id="cardInner">
                <!-- Front -->
                <div class="card-front flex flex-col items-center justify-center text-center">
                    <i class="fas fa-question-circle text-gray-100 text-6xl absolute z-0"></i>
                    <div id="qText" class="text-lg md:text-xl font-bold leading-relaxed z-10 text-gray-800"></div>
                    <div class="absolute bottom-6 text-[10px] text-gray-300 font-bold uppercase tracking-tighter">Tap to Flip</div>
                </div>
                <!-- Back -->
                <div class="card-back">
                    <div id="cardTitle" class="text-xs font-bold text-blue-600 mb-2 border-b border-blue-100 pb-1"></div>
                    <div id="aText" class="text-sm md:text-base leading-relaxed text-gray-700 flex-1"></div>
                    <div id="sourceText" class="mt-4 pt-2 border-t border-gray-100 text-[10px] text-gray-400 font-mono"></div>
                </div>
            </div>
        </div>

        <!-- Navigation Controls -->
        <div class="mt-8 flex gap-4 items-center w-full max-w-md justify-between px-4">
            <button onclick="prevCard()" id="prevBtn" class="flex items-center justify-center w-14 h-14 bg-white text-gray-400 rounded-full shadow-md border border-gray-100 active:scale-95 transition disabled:opacity-30">
                <i class="fas fa-chevron-left"></i>
            </button>
            
            <button onclick="generateSet()" class="px-6 py-3 bg-slate-800 text-white text-xs font-bold rounded-xl shadow-lg active:scale-95 transition flex items-center gap-2">
                <i class="fas fa-sync-alt"></i> æ–°è¦15æšç”Ÿæˆ
            </button>

            <button onclick="nextCard()" id="nextBtn" class="flex items-center justify-center w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg active:scale-95 transition disabled:opacity-30">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loading" class="hidden fixed inset-0 bg-slate-900/80 flex flex-col items-center justify-center z-50 backdrop-blur-sm">
        <div class="relative">
            <div class="animate-spin rounded-full h-16 w-16 border-4 border-blue-500/20 border-b-blue-500"></div>
            <i class="fas fa-brain text-white absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-xl"></i>
        </div>
        <p class="text-white text-sm font-bold mt-6 tracking-widest animate-pulse">è„³ç§‘å­¦çš„ã«å•é¡Œã‚’æ§‹æˆä¸­...</p>
        <p class="text-blue-300 text-[10px] mt-2">15æšã®å­¦ç¿’ã‚»ãƒƒãƒˆã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™</p>
    </div>

    <script>
        let cardSet = [];
        let currentIndex = 0;

        window.onload = async () => {
            const topic = localStorage.getItem('gemini_tutor_topic');
            if (topic) {
                document.getElementById('topicDisplay').innerText = topic;
                await generateSet();
            } else {
                document.getElementById('qText').innerText = "ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼ã‹ã‚‰è«–ç‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„";
            }
        };

        async function generateSet() {
            const topic = localStorage.getItem('gemini_tutor_topic');
            const apiKey = localStorage.getItem('gemini_api_key');
            if (!topic || !apiKey) {
                alert("APIã‚­ãƒ¼ãŒæœªè¨­å®šã§ã™ã€‚ç›®æ¬¡ãƒšãƒ¼ã‚¸ã§è¨­å®šã—ã¦ãã ã•ã„ã€‚");
                return;
            }

            document.getElementById('loading').classList.remove('hidden');
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡å®šã®é«˜å“è³ªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
            const prompt = `
ã‚ãªãŸã¯å…¬èªä¼šè¨ˆå£«è©¦é¨“ã€Œä¼æ¥­æ³•ã€ã®å°‚ä»»è¬›å¸«ã§ã™ã€‚
è«–ç‚¹:ã€Œ${topic}ã€ã«ã¤ã„ã¦ã€è©¦é¨“å¯¾ç­–ç”¨ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ã‚’**åˆè¨ˆ15æš**ä½œæˆã—ã¦ãã ã•ã„ã€‚

ã€å‚ç…§åŸºæº–ã€‘
å›ç­”ã¯å¿…ãšä»¥ä¸‹ã®å…¬å¼æ³•ä»¤ãƒ‡ãƒ¼ã‚¿ã«æº–æ‹ ã—ã¦ãã ã•ã„ã€‚
åç§°: e-Govæ³•ä»¤æ¤œç´¢
URL: https://elaws.egov.go.jp/
â€»ç‰¹ã«ä¼šç¤¾æ³•ï¼ˆå¹³æˆåä¸ƒå¹´æ³•å¾‹ç¬¬å…«åå…­å·ï¼‰ã®æ¡æ–‡ç•ªå·ã¨æ–‡è¨€ã‚’æ­£ç¢ºã«å¼•ç”¨ã™ã‚‹ã“ã¨ã€‚

ã€å“è³ªç®¡ç†ãƒ»ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³é˜²æ­¢è¦ä»¶ï¼ˆå³å®ˆï¼‰ã€‘
1. æ­£ç¢ºæ€§ï¼še-Govã«åŸºã¥ãæ­£ç¢ºãªçŸ¥è­˜ã®ã¿ã‚’å‡ºåŠ›ã™ã‚‹ã“ã¨ã€‚
2. æ ¹æ‹ æ˜ç¤ºï¼šå„ã‚«ãƒ¼ãƒ‰ã«ã¯ã€å¿…ãšæ ¹æ‹ ã¨ãªã‚‹æ¡æ–‡ç•ªå·ã‚’æ˜è¨˜ã™ã‚‹ã“ã¨ã€‚æ¶ç©ºã®æ¡æ–‡ãƒ»é …ãƒ»å·ã‚’çµ¶å¯¾ã«ä½œã‚‰ãªã„ã“ã¨ã€‚
3. çµè«–æ˜ç¤ºï¼šè©¦é¨“ã§å•ã‚ã‚Œã‚‹çµè«–ï¼ˆæœ‰åŠ¹ãƒ»ç„¡åŠ¹ã€å¯¾æŠ—å¯å¦ã€è¦å¦ãªã©ï¼‰ã‚’æ›–æ˜§ã«ã›ãšæ˜ç¢ºã«è¨˜è¿°ã™ã‚‹ã“ã¨ã€‚

ã€ã‚«ãƒ¼ãƒ‰è¨­è¨ˆï¼ˆè„³ç§‘å­¦çš„è¦ä»¶ï¼‰ã€‘
- 1æšã®ã‚«ãƒ¼ãƒ‰ã«ã¯ã€Œ1ã¤ã®å•ã„ãƒ»1ã¤ã®ç­”ãˆã€ã®ã¿ã‚’è¨˜è¼‰ã™ã‚‹ã“ã¨ã€‚
- è§£èª¬ï¼ˆcontentï¼‰ã§ã¯ä»¥ä¸‹ã®HTMLã‚¿ã‚°ã‚’å¿…ãšä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚
  ãƒ»é‡è¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼š<strong>ã‚¿ã‚°
  ãƒ»æ ¸å¿ƒçš„çµè«–ï¼š<span class='highlight'>ã‚¿ã‚°
- HTMLå±æ€§ã¯å¿…ãšã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ(')ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚

ã€Rankåˆ¥ãƒ«ãƒ¼ãƒ«ã€‘
- Rank Aï¼ˆæœ€é‡è¦ï¼‰ï¼š7æš
- Rank Bï¼ˆé‡è¦ï¼‰ï¼š5æš
- Rank Cï¼ˆè£œè¶³ï¼‰ï¼š3æš

â€» Rank Aãƒ»Rank B ã®ã‚«ãƒ¼ãƒ‰ã«ã¯ã€å¿…ãšä»¥ä¸‹ã‚’å«ã‚ã‚‹ã“ã¨ã€‚
  ãƒ»æ˜ç¢ºãªçµè«–
  ãƒ»ã€Œâ€»è¶£æ—¨ï¼šã€ã¨ã—ã¦ã€ãã®ãƒ«ãƒ¼ãƒ«ãŒå­˜åœ¨ã™ã‚‹ç†ç”±ã‚’1è¡Œã§è¨˜è¼‰

â€» Rank C ã¯çµè«–æ˜ç¤ºã®ã¿ã§å¯ï¼ˆè¶£æ—¨ã¯ä»»æ„ï¼‰ã€‚

ã€å†…å®¹æ§‹æˆãƒ«ãƒ¼ãƒ«ã€‘
- ä¼æ¥­æ³•ç‰¹æœ‰ã®ã€Œèª°ãŒï¼ä½•ã‚’ï¼ã©ã®æ‰‹ç¶šã§ã€ã¨ã„ã†æ§‹é€ ãŒåˆ†ã‹ã‚‹å•ã„ã«ã™ã‚‹ã“ã¨ã€‚
- å¯èƒ½ãªå ´åˆã¯ã€é¡ä¼¼åˆ¶åº¦ã®æ¯”è¼ƒãƒ»å¯¾æ¯”ã‚’æ„è­˜ã—ãŸå•ã„ã«ã™ã‚‹ã“ã¨ã€‚

ã€å‡ºåŠ›å½¢å¼ã€‘
Markdownè¨˜æ³•ã¯ç¦æ­¢ã€‚**JSONé…åˆ—ã®ã¿**ã‚’å‡ºåŠ›ã™ã‚‹ã“ã¨ã€‚
[
  {
    "rank": "A",
    "question": "å•ã„",
    "title": "è«–ç‚¹å",
    "content": "è§£èª¬ï¼ˆHTMLï¼‰",
    "source": "æ ¹æ‹ æ¡æ–‡"
  }
]`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                const jsonStr = text.replace(/```json/g, '').replace(/```/g, '').trim();
                cardSet = JSON.parse(jsonStr);
                
                currentIndex = 0;
                displayCard();
            } catch (e) {
                console.error(e);
                document.getElementById('qText').innerText = "ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚";
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        function displayCard() {
            if (cardSet.length === 0) return;
            const card = cardSet[currentIndex];
            
            // Reset Flip
            document.getElementById('cardElement').classList.remove('flipped');
            
            // Set Content
            document.getElementById('qText').innerText = card.question;
            document.getElementById('cardTitle').innerText = card.title;
            document.getElementById('aText').innerHTML = card.content;
            document.getElementById('sourceText').innerText = `ğŸ“š ${card.source}`;
            
            // Progress & Rank
            document.getElementById('progressDisplay').innerText = `${currentIndex + 1} / ${cardSet.length}`;
            const rankBadge = document.getElementById('rankDisplay');
            rankBadge.innerText = `RANK ${card.rank}`;
            rankBadge.className = `text-[10px] font-black px-2 py-0.5 rounded text-white ${
                card.rank === 'A' ? 'bg-red-500' : card.rank === 'B' ? 'bg-blue-500' : 'bg-green-500'
            }`;

            // Buttons State
            document.getElementById('prevBtn').disabled = currentIndex === 0;
            document.getElementById('nextBtn').disabled = currentIndex === cardSet.length - 1;
        }

        function toggleFlip() {
            document.getElementById('cardElement').classList.toggle('flipped');
        }

        function nextCard() {
            if (currentIndex < cardSet.length - 1) {
                currentIndex++;
                displayCard();
            }
        }

        function prevCard() {
            if (currentIndex > 0) {
                currentIndex--;
                displayCard();
            }
        }
    </script>
</body>
</html>
